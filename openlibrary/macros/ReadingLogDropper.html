$def with (lists, work=None, edition=None, users_work_read_status=None, reading_log_only=False, use_work=False, page_url=None, uid='')

$ user_key = ctx.user and ctx.user.key
$ username = ctx.user and ctx.user.key.split('/')[-1]
$ work_key = work and work.key
$ edition_key = edition and edition.key

$ unique_postfix = '-%s' % str(uid) if uid else ''

$if ctx.user or not work_key:
  <div class="widget-add $:(not work_key and 'old-style-lists')">
    <div class="dropit Tools">
      $if edition_key and not work_key:
        <div class="dropper on edition-page-lists-dropdown">
      $else:
        <div class="dropper on">
      $if work_key:
        <div class="log-work">
          <form class="readingLog" method="POST" action="$(work_key)/bookshelves.json">
            $if users_work_read_status == 3:
                $ message = _("Already Read")
            $elif users_work_read_status == 2:
                $ message = _("Currently Reading")
            $else:
                $ message = _("Want to Read")

            $ action_value = 'remove' if users_work_read_status else 'add'
            $ bookshelf_id_value = users_work_read_status or '1'
            $ activated_status = 'activated' if users_work_read_status else 'unactivated'
            $ checkmark_visibility = '' if users_work_read_status else ' hidden'
            $ checkmark = '<span class="activated-check">âœ“</span> ' if users_work_read_status else ''

            <input id="" type="hidden" name="action" value="$(action_value)"/>
            <input type="hidden" name="redir" value="true"/>
            <input id="" type="hidden" name="bookshelf_id" value="$(bookshelf_id_value)"/>

            <button class="book-progress-btn want-to-read $(activated_status)" type="submit">
              $:(checkmark)$(message)
            </button>

            $if edition_key:
              <input type="hidden" id="edition_id" name="edition_id" value="$(edition_key)"/>
          </form>

          <a href="javascript:;" class="dropclick dropclick-$(activated_status)">
            <div class="arrow arrow-$(activated_status)"></div>
          </a>
        </div>
        <div class="dropdown">
          <div class="read-statuses">
            $if users_work_read_status == 2 or users_work_read_status == 3:
              <form class="readingLog" method="POST" action="$(work_key)/bookshelves.json">
                <input type="hidden" name="action" value="add"/>
                <input type="hidden" name="redir" value="true"/>
                <input type="hidden" name="bookshelf_id" value="1"/>
                $if edition_key:
                  <input type="hidden" name="edition_id" value="$(edition_key)"/>
                <button class="nostyle-btn" type="submit">$_('Want to Read')</button>
              </form>

            $if users_work_read_status != 2:
              <form class="readingLog" method="POST" action="$(work_key)/bookshelves.json">
                <input type="hidden" name="action" value="add"/>
                <input type="hidden" name="redir" value="true"/>
                <input type="hidden" name="bookshelf_id" value="2"/>
                $if edition_key:
                  <input type="hidden" name="edition_id" value="$(edition_key)"/>
                <button class="nostyle-btn" type="submit">$('Currently Reading')</button>
              </form>

            $if users_work_read_status != 3:
              <form class="readingLog" method="POST" action="$(work_key)/bookshelves.json">
                <input type="hidden" name="action" value="add"/>
                <input type="hidden" name="redir" value="true"/>
                <input type="hidden" name="bookshelf_id" value="3"/>
                $if edition_key:
                  <input type="hidden" name="edition_id" value="$(edition_key)"/>
                <button class="nostyle-btn" type="submit">$_('Already Read')</button>
              </form>
          </div>

          $if not reading_log_only:
            <div class="reading-lists">
              <p class="reading-list-title">$_('My Reading Lists:')</p>
              <div class="my-lists">
                $for list in lists:
                    $if list['active']:
                      <p class="list">
                          <a href="$list.key" class="add-to-list" data-list-key="$list.key">$list.name</a>
                      </p>
              </div>
              $if edition_key:
                  <p class="create checkboxes">
                    <label>
                       <input type="checkbox" class="work-checkbox"
                          $if use_work:
                            checked
                       /> <span>$_('Use this Work')</span>
                    </label>
                  </p>
              <p class="create"><a href="javascript:;" class="create-new-list">$_('Create a new list')</a>
                <a aria-controls="addList"
                  class="hidden listClick dialog--open"></a>
              </p>
            </div>
        </div>
      $else:
          $if username:
            <div class="reading-lists">
              <a href="javascript:;" class="dropclick">
                <h3>$_('Add to List')</h3>
                <div class="arrow arrow-activated"></div>
              </a>
              <div class="dropdown">
                <div class="my-lists">
                  $for list in lists:
                    $if list['active']:
                      <p class="list">
                          <a href="$list.key" class="add-to-list" data-list-key="$list.key">$list.name</a>
                      </p>
                </div>
                <p class="create"><a href="javascript:;" class="create-new-list">$_('Create a new list')</a>
                </p>
              </div>
            </div>
          $else:
            <a href="/account/login?redirect=$page_url" class="dropclick plain">
              <h3>$('Add to List')</h3>
              <div class="arrow"></div>
            </a>
      </div>
    </div>
  </div>
$else:
  <div class="dropit">
      <div class="dropper on">
        $if work:
          <div class="log-work">
            <form method="POST" action="$(work_key)/bookshelves.json">
              <input type="hidden" name="action" value="add"/>
                $if edition_key:
                  <input type="hidden" name="edition_id" value="$(edition_key)"/>

                <button class="unactivated" type="submit">$_('Want to Read')</button>
              </form>
              <a href="/account/login?redirect=$(page_url)" class="dropclick-prevent dropclick-unactivated">
                <div class="arrow arrow-unactivated"></div>
              </a>
          </div>
      </div>
  </div>
