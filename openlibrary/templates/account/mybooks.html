$def with (user, mybooks, public=False, owners_page=False, counts=None, lists=None)

$ username = user.key.split('/')[-1]
$if user.is_beta_tester():
  $ current_goal = get_reading_goals()

<div class="chip-group">
  $if not current_goal:
    <span class="chip value-chip category-chip chip--selectable goal-chip">
      <a id="set-reading-goal-link" data-ol-link-track="MyBooksLandingPage|SetReadingGoal"
        href="javascript:;">$:_('Set <span id="reading-goal-current-year">2023</span> reading goal')</a>
    </span>

      $ reading_goal_form = render_template('check_ins/reading_goal_form')
      $:render_template('native_dialog', 'yearly-goal-modal', reading_goal_form, title="Yearly Reading Goal")
    $else:
      $:render_template('check_ins/reading_goal_progress', [current_goal])

  <span class="chip value-chip category-chip chip--selectable">
    <a data-ol-link-track="MyBooksSidebar|ReadingStats"
       href="/account/books/already-read/stats">$_('My Reading Stats')</a>
  </span>
  <span class="chip value-chip category-chip chip--selectable">
    <a data-ol-link-track="MyBooksSidebar|ImportExport"
       href="/account/import">$_('Import & Export Options')</a>
  </span>
</div>

$code:
    def compact_carousel(data):
        key, title, url = data
        books = mybooks[key].docs
        count = mybooks[key].total_results
        return render_template("books/custom_carousel", **{
            "books": books,
            "title": "%s (%d)" % (title, count),
            "url": url,
            "key": key,
            "min_books": 1,
            "load_more": None,
            "compact_mode": True,
            "test": False
        }) if books else None

$def empty_carousel(data):
  $ key, title, url = data
  <div class="carousel-section-header">
    <h2 class="home-h2"><a name="$key" href="$url">$title</a></h2>
  </div>
  <p>$_('No books are on this shelf')</p>

$# Data for carousels
$ loans = ["loans", _('My Loans'), "/account/loans"]
$ currently_reading = ["currently-reading", _('Currently Reading'), "/account/books/currently-reading"]
$ want_to_read = ["want-to-read", _('Want to Read'), "/account/books/want-to-read"]
$ already_read = ["already-read", _('Already Read'), "/account/books/already-read"]

$# Render carousels
$:(compact_carousel(loans) or empty_carousel(loans))
$:(compact_carousel(currently_reading) or empty_carousel(currently_reading))
$:(compact_carousel(want_to_read) or empty_carousel(want_to_read))
$:(compact_carousel(already_read) or empty_carousel(already_read))
