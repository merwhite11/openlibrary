$def with (form)

$ i18n_strings = {
    $ "password_length_err": _("Must be between 3 and 20 characters")
    $ }

$# :param openlibrary.plugins.upstream.forms.RegisterForm form:

$var title: $_("Sign Up to Open Library")

<div class="ol-page-signup">
    <div id="contentHead" class="ol-signup-hero">
        <h1>$_("Sign Up")</h1>
        <p>$_("Get your free Open Library card and borrow digital books from the nonprofit Internet Archive")</p>
        <ul className="create-form__iconlist">
            <li>ðŸ“š $:_('<a href="/help/faq/borrow" target="_blank">Borrow</a> up to 5 books at a time')</li>
            <li>ðŸ“‹ $:_('<a href="/help/faq/reading-log" target="_blank">Keep track</a> of what you\'re reading')</li>
            <li>ðŸŽ“ $:_('<a href="/help" target="_blank">Learn More</a> about how it works')</li>
        </ul>
    </div>

    <div id="contentBody" class="ol-signup-form">

    $if not ctx.user:
        $:render_template("account/ia_thirdparty_logins")
        <div class="login-big-or">$_('OR')</div>

    $def field(input, suffix=''):
        $# :param openlibrary.utils.form.Input input:
        $# :param str suffix: HTML to put at bottom of input

        <div class="formElement">
            <div class="label">
                <label for="$input.id">$input.description</label>
                $if input.help:
                    <span class="smaller lighter">$input.help</span>
            </div>
            <div class="input">
                $:input.render()
                $if input.name == 'password':
                    $ i18n_strings = {
                    $    "show_password": _('Show password'),
                    $    "hide_password": _('Hide password')
                    $  }
                    <a href="javascript:;" class="password-visibility-toggle" data-i18n="$json_encode(i18n_strings)">$i18n_strings["show_password"]</a>
                <span class="invalid clearfix create-form__error" id="$(input.id)Message">$input.note</span>
                <span class="sansserif smaller lighter">$:suffix</span>
            </div>
        </div>


    $if ctx.user:
        $def user_link(): <a href="$ctx.user.key">$ctx.user.displayname</a>
        <p>$:_("You are already logged into Open Library as %(user)s.", user=str(user_link()))</p>
        <p>$:_('If you\'d like to create a new, different Open Library account, you\'ll need to <a href="javascript:;" onclick="document.forms[\'hamburger-logout\'].submit()">log out</a> and start the signup process afresh.')</p>
    $else:
        <form class="olform create create-form" name="signup" method="post" data-i18n="$json_encode(i18n_strings)" action="">
            $if form.note:
                <div class="note">$form.note</div>

            $def screenname_url(): $_('Your URL'): https://openlibrary.org/people/<span id="userUrl">$(form.username.value or _('screenname'))</span>

            $:field(form.email)
            $:field(form.username, suffix=str(screenname_url()))
            $:field(form.password)

            <label>
                $:form.ia_newsletter.render() $:form.ia_newsletter.description
            </label>

            <hr/>
            <div class="formElement bottom">
                <br/>
                $ sitekey = classes = callback = ''
                $if form.has_recaptcha:
                    $ callback = "data-callback=submitCreateAccountForm"
                    $ classes = 'g-recaptcha'
                    $ sitekey = "data-sitekey=%s" % form['recaptcha'].public_key
                    $:render_template("recaptcha", form['recaptcha'].public_key, error=None, invisible=True)
                <button type="submit" name="signup" id="signup" class="larger $classes cta-btn" $sitekey $callback>$_("Sign Up with Email")</button>
                <small>$:_('By signing up, you agree to the Internet Archive\'s <a href="//archive.org/about/terms.php" target="_blank">Terms of Service</a>.')</small>
            </div>
        </form>
        <p>$:_('Already an Internet Archive user? <a href="/account/login">Log in</a>')</p>
    </div>
</div>

